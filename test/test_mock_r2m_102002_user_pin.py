import unittest

import redis
import time
from concurrent.futures import ProcessPoolExecutor

r = redis.Redis(host='localhost', port=6379)
dt = '2020-04-25'
user_pin = 'mythling'
vec = [-0.23724064818168949520, 0.03306523783586075987, -0.08497630252384760774, 0.00895396226354287957,
       0.10745647159054654007, -0.06007996182176951472, 0.09807567305915147748, 0.04517341231445454880,
       0.12830542233198868884, -0.02580306232211793463, 0.09334919858070409027, -0.08075936510676832991,
       -0.02655472569023659135, 0.05763216406401765191, -0.05663989662423555421, -0.08077605943623882012,
       -0.03233934762865926793, 0.16573923394748041327, 0.17399052264918438149, 0.09557131892284054242,
       0.00204232984952185895, 0.05230338753521064643, -0.01064952422894490519, -0.04843736902712864056,
       0.04646897250562663506, -0.09572570387462560337, 0.12450353528963929717, 0.09844697635962633420,
       -0.03531335661602759413, 0.11109076320896668633, 0.12877087194667563574, 0.12839790625502467414,
       0.10147439701692843872, -0.05558407922550586550, -0.26024491590949117015, 0.04612586258282809493,
       0.14092355793694610888, -0.00374342755702073695, -0.08694303570962516603, 0.01066794871046804205,
       -0.20557679018022576023, 0.15302466276411028079, -0.04001982194461325276, 0.02555410684223100026,
       -0.03748401520830615258, 0.06375220568226405704, -0.00491887975888972897, 0.14341569113883573250,
       0.08343059592153272142, 0.01606452955576140318, 0.00448266405590822762, 0.03057380935080977746,
       -0.05907041497226815652, -0.05023023045581508778, -0.11030184541063800530, -0.04896947475971725333,
       0.06843204356874477146, 0.00396782038685007232, 0.02051782197271388719, 0.05011044869397734275,
       0.04945552985999505935, 0.06884093574865350618, -0.02741847357918492448, 0.06387297744246651920,
       -0.01619138379802090646, 0.02478814991673281704, -0.02126434982668039611, 0.00521734706855870364,
       -0.02036494919169017440, -0.06333277818662474967, 0.05317773610449808702, 0.10955944788523780398,
       -0.20640194436243136655, -0.24228011254061559976, -0.03009068240632090108, 0.07533602169777038615,
       0.15429981836535905382, 0.03000405464596845109, 0.09964029736939881976, 0.00323747704818638663,
       -0.17655823863042255373, -0.03714495647674035533, -0.03759818067621739646, -0.02799151229725113654,
       -0.10440959997424704986, 0.04524676614576279149, -0.03586511818620434500, -0.02818067896327875951,
       0.14923240054869613136, -0.13316687265648780025, 0.23773228667024806637, -0.05595455153279590976,
       -0.01333354849076778988, -0.00374477832633413011, 0.10391139211918978824, -0.14474010764570591214,
       0.00730544584232908304, 0.31351627287547656486, 0.05082821716245113780, 0.06985860433688256821]

data = {
    'user_pin': user_pin,
    'dt': dt,
    'vec': vec,
}

key = 'cupid-sim-%s-sim_dmcqm_lhmx_sku_rec_faiss_user_vec_scene102002_v1_s_d_d100_e100' % user_pin

r.hmset(key, data)
a = r.hgetall(key)
print(a[b'user_pin'])
#
# # cupid-sim-mythling-sim_dmcqm_lhmx_sku_rec_faiss_user_vec_scene102002_v1_s_d_d100_e100
# r.hmset('ln1', {'101001100': '101001100', 'b': 'b'})
# r.hmset('ln2', {'101001100': 'a1', 'b': 'b1'})
#
# with r.pipeline(transaction=False) as p:
#     for d in ['ln1', 'ln2']:
#         p.hmget(d, '101001100')
#     result = p.execute()
# print(result)
